# CI/CD æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»PCL2 Reforgedé¡¹ç›®çš„æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²æµç¨‹ã€‚

## ğŸš€ è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ

### GitHub Actions å·¥ä½œæµ

é¡¹ç›®åŒ…å«ä¸‰ä¸ªä¸»è¦çš„GitHub Actionså·¥ä½œæµï¼š

#### 1. CI å·¥ä½œæµ (`.github/workflows/ci.yml`)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- åˆ›å»ºPull Requeståˆ° `main` æˆ– `develop` åˆ†æ”¯

**åŠŸèƒ½ï¼š**
- å¤šNode.jsç‰ˆæœ¬æµ‹è¯• (18, 20, 22)
- TypeScriptç±»å‹æ£€æŸ¥
- ESLintä»£ç è§„èŒƒæ£€æŸ¥
- æ„å»ºäº§ç‰©éªŒè¯

#### 2. å¼€å‘æ„å»ºå·¥ä½œæµ (`.github/workflows/build-dev.yml`)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- åˆ›å»ºPull Requeståˆ° `main` æˆ– `develop` åˆ†æ”¯

**åŠŸèƒ½ï¼š**
- å¤šå¹³å°æ„å»º (Windows, Linux, macOS)
- ä¸Šä¼ æ„å»ºäº§ç‰©ä¸ºArtifacts
- PRè‡ªåŠ¨è¯„è®ºæ„å»ºä¿¡æ¯
- 7å¤©ä¿ç•™æœŸ

#### 3. å‘å¸ƒå·¥ä½œæµ (`.github/workflows/build.yml`)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€ç‰ˆæœ¬æ ‡ç­¾ (å¦‚ `v1.0.0`)
- æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)

**åŠŸèƒ½ï¼š**
- å¤šå¹³å°æ„å»º (Windows, Linux, macOS)
- è‡ªåŠ¨åˆ›å»ºGitHub Release
- ä¸Šä¼ æ„å»ºäº§ç‰©åˆ°Releasesé¡µé¢

## ğŸ”„ æŒç»­æ„å»º

### æ¯æ¬¡æ¨é€æ„å»º

é¡¹ç›®é…ç½®äº†æŒç»­æ„å»ºæµç¨‹ï¼Œæ¯æ¬¡ä»£ç æ¨é€éƒ½ä¼šè‡ªåŠ¨æ„å»ºï¼š

#### å¼€å‘æ„å»º
- **è§¦å‘**: æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- **åŠŸèƒ½**: å¤šå¹³å°æ„å»ºï¼Œä¸Šä¼ ä¸ºArtifacts
- **ä¿ç•™**: 7å¤©
- **ç”¨é€”**: å¼€å‘æµ‹è¯•ã€PRéªŒè¯

#### å‘å¸ƒæ„å»º
- **è§¦å‘**: æ¨é€ç‰ˆæœ¬æ ‡ç­¾
- **åŠŸèƒ½**: åˆ›å»ºGitHub Release
- **ä¿ç•™**: æ°¸ä¹…
- **ç”¨é€”**: æ­£å¼å‘å¸ƒ

### æ„å»ºæµç¨‹

```
ä»£ç æ¨é€ â†’ å¼€å‘æ„å»º â†’ Artifactsä¸Šä¼  â†’ PRè¯„è®º
    â†“
ç‰ˆæœ¬æ ‡ç­¾ â†’ å‘å¸ƒæ„å»º â†’ GitHub Release â†’ ç”¨æˆ·ä¸‹è½½
```

## ğŸ“¦ å‘å¸ƒæµç¨‹

### è‡ªåŠ¨å‘å¸ƒ

1. **åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾**
   ```bash
   # ä½¿ç”¨å‘å¸ƒè„šæœ¬
   ./scripts/release.sh patch  # è¡¥ä¸ç‰ˆæœ¬ (1.0.0 -> 1.0.1)
   ./scripts/release.sh minor  # æ¬¡è¦ç‰ˆæœ¬ (1.0.0 -> 1.1.0)
   ./scripts/release.sh major  # ä¸»è¦ç‰ˆæœ¬ (1.0.0 -> 2.0.0)
   ```

2. **æ‰‹åŠ¨åˆ›å»ºæ ‡ç­¾**
   ```bash
   git tag -a v1.0.0 -m "Release 1.0.0"
   git push origin v1.0.0
   ```

### å‘å¸ƒè„šæœ¬åŠŸèƒ½

`scripts/release.sh` è„šæœ¬æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… å·¥ä½œç›®å½•çŠ¶æ€æ£€æŸ¥
- âœ… åˆ†æ”¯æ£€æŸ¥ (å»ºè®®åœ¨mainåˆ†æ”¯å‘å¸ƒ)
- âœ… è‡ªåŠ¨æ‹‰å–æœ€æ–°ä»£ç 
- âœ… è¿è¡Œæµ‹è¯•å’Œæ„å»º
- âœ… è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°
- âœ… åˆ›å»ºGitæ ‡ç­¾
- âœ… æ¨é€åˆ°è¿œç¨‹ä»“åº“

### ä½¿ç”¨ç¤ºä¾‹

```bash
# å‘å¸ƒè¡¥ä¸ç‰ˆæœ¬
./scripts/release.sh patch

# å‘å¸ƒæ¬¡è¦ç‰ˆæœ¬
./scripts/release.sh minor

# å‘å¸ƒä¸»è¦ç‰ˆæœ¬
./scripts/release.sh major
```

## ğŸ”§ æœ¬åœ°æ„å»º

### å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘æ¨¡å¼
pnpm run dev

# å¿«é€Ÿå¯åŠ¨ (ä½¿ç”¨æ„å»ºæ–‡ä»¶)
pnpm run dev:quick
```

### ç”Ÿäº§æ„å»º

```bash
# æ„å»ºæ‰€æœ‰å¹³å°
pnpm run build

# æ„å»ºç‰¹å®šå¹³å°
pnpm run dist:win    # Windows
pnpm run dist:linux  # Linux
pnpm run dist:mac    # macOS
```

## ğŸ“‹ æ„å»ºäº§ç‰©

### æ–‡ä»¶ç»“æ„

```
release/
â”œâ”€â”€ PCL2 Reforged-1.0.0-win-x64.exe          # Windowsä¾¿æºç‰ˆ
â”œâ”€â”€ PCL2 Reforged-1.0.0-linux-x64.AppImage   # Linux AppImage
â”œâ”€â”€ PCL2 Reforged-1.0.0-linux-x64.tar.gz     # Linuxå‹ç¼©åŒ…
â””â”€â”€ PCL2 Reforged-1.0.0-mac-x64.dmg          # macOSå®‰è£…åŒ…
```

### å¹³å°æ”¯æŒ

| å¹³å° | æ ¼å¼ | è¯´æ˜ |
|------|------|------|
| Windows | `.exe` | ä¾¿æºç‰ˆï¼Œæ— éœ€å®‰è£… |
| Linux | `.AppImage` | é€šç”¨Linuxå‘è¡Œç‰ˆ |
| Linux | `.tar.gz` | å‹ç¼©åŒ…ï¼Œæ‰‹åŠ¨è§£å‹ |
| macOS | `.dmg` | å®‰è£…åŒ… |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Linuxæ„å»ºå¤±è´¥

**é—®é¢˜ï¼š** å›¾æ ‡æ–‡ä»¶é”™è¯¯å¯¼è‡´æ„å»ºå¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
- CIè„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå ä½å›¾æ ‡
- æ‰‹åŠ¨æ·»åŠ  `assets/icon.png` æ–‡ä»¶ (512x512 PNG)

#### 2. Windowsæ„å»ºå¤±è´¥

**é—®é¢˜ï¼š** Wineç¯å¢ƒé—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿åœ¨Windowsç¯å¢ƒä¸­æ„å»º
- æ£€æŸ¥electron-builderé…ç½®

#### 3. ç‰ˆæœ¬å†²çª

**é—®é¢˜ï¼š** ç‰ˆæœ¬å·å·²å­˜åœ¨

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨å‘å¸ƒè„šæœ¬è‡ªåŠ¨ç®¡ç†ç‰ˆæœ¬
- æ‰‹åŠ¨æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æ„å»ºæ—¥å¿—**
   ```bash
   pnpm run build 2>&1 | tee build.log
   ```

2. **æ£€æŸ¥æ„å»ºäº§ç‰©**
   ```bash
   ls -la dist/
   ls -la release/
   ```

3. **éªŒè¯åº”ç”¨**
   ```bash
   # æµ‹è¯•æ„å»ºçš„åº”ç”¨
   pnpm run dev:quick
   ```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¶æ„](./ARCHITECTURE.md)
- [å¼€å‘æŒ‡å—](./DEVELOPMENT.md)
- [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub Actionsæ–‡æ¡£](https://docs.github.com/en/actions)
- [Electron Builderæ–‡æ¡£](https://www.electron.build/)
- [Viteæ–‡æ¡£](https://vitejs.dev/) 